import{c as Ie,r as N,j as t,a as et,H as tt}from"./app-DggIHyo9.js";import{A as st}from"./app-layout-19VJyFC6.js";import"./app-wSW00SRY.js";import"./button-DSV5da0i.js";import"./index-B9Z1U0H-.js";import"./index-65G2G430.js";import"./index-AaGKiXUI.js";function rt(i){const e=i.clipboardData?.items;if(!e)return null;for(const a of e)if(a.type.startsWith("image/")){const g=a.getAsFile();if(!g)return null;const _=a.type==="image/png"?"png":a.type==="image/webp"?"webp":"jpg";return new File([g],`pasted-${Date.now()}.${_}`,{type:a.type})}return null}function He(){return{note:"",image_files:[],image_preview_urls:[]}}function jt(i){const e=Ie.c(130),{auth:a,entities:g,ratings:_,stores:J}=i;let Q;e[0]!==g?(Q=g===void 0?[]:g,e[0]=g,e[1]=Q):Q=e[1];const Oe=Q;let Y;e[2]!==_?(Y=_===void 0?[]:_,e[2]=_,e[3]=Y):Y=e[3];const W=Y;let Z;e[4]!==J?(Z=J===void 0?[]:J,e[4]=J,e[5]=Z):Z=e[5];const Le=Z,[v,Ke]=N.useState("daily"),[x,Je]=N.useState(""),[S,Qe]=N.useState(""),[w,Ye]=N.useState(ut);let I;e[6]===Symbol.for("react.memo_cache_sentinel")?(I={},e[6]=I):I=e[6];const[c,Be]=N.useState(I),[ee,Me]=N.useState(!1);let te;e[7]===Symbol.for("react.memo_cache_sentinel")?(te={},e[7]=te):te=e[7];const[p,Ve]=N.useState(te);let se;if(e[8]!==v||e[9]!==Oe||e[10]!==x){let s;e[12]!==v||e[13]!==x?(s=r=>{const n=r.date_range_type===v,l=!x||r.report_type===x;return n&&l},e[12]=v,e[13]=x,e[14]=s):s=e[14],se=Oe.filter(s),e[8]=v,e[9]=Oe,e[10]=x,e[11]=se}else se=e[11];const h=se;let re,le;e[15]!==h?(re=()=>{Be(s=>{const r={...s};return h.forEach(n=>{r[n.id]||(r[n.id]={entity_id:n.id,rating_id:null,notes:[]})}),r})},le=[h],e[15]=h,e[16]=re,e[17]=le):(re=e[16],le=e[17]),N.useEffect(re,le);let ie;e[18]!==h?(ie=[...h].sort(mt),e[18]=h,e[19]=ie):ie=e[19];const b=ie;let ne;e[20]!==b?(ne=b.reduce(dt,{}),e[20]=b,e[21]=ne):ne=e[21];const j=ne;let oe;if(e[22]!==j||e[23]!==b){const s=Object.keys(j);let r;e[25]!==b?(r=(n,l)=>{const o=b.find(f=>(f.category?.label||"Uncategorized")===n)?.category,d=b.find(f=>(f.category?.label||"Uncategorized")===l)?.category,m=o?.sort_order??Number.MAX_SAFE_INTEGER,u=d?.sort_order??Number.MAX_SAFE_INTEGER;return m!==u?m-u:n.localeCompare(l)},e[25]=b,e[26]=r):r=e[26],oe=s.sort(r),e[22]=j,e[23]=b,e[24]=oe}else oe=e[24];const Pe=oe;let ae;e[27]===Symbol.for("react.memo_cache_sentinel")?(ae=(s,r)=>{Be(n=>{const l=n[s]??{entity_id:s,rating_id:null,notes:[]};return{...n,[s]:{...l,...r}}})},e[27]=ae):ae=e[27];const ze=ae;let ce;e[28]===Symbol.for("react.memo_cache_sentinel")?(ce=(s,r,n)=>{Be(l=>{const o=l[s];if(!o)return l;const d=[...o.notes],m=d[r]??He();return d[r]={...m,...n},{...l,[s]:{...o,notes:d}}})},e[28]=ce):ce=e[28];const Ge=ce;let de;e[29]!==c?(de=s=>{const r=c[s]??{notes:[]};ze(s,{notes:[...r.notes,He()]})},e[29]=c,e[30]=de):de=e[30];const q=de;let me;e[31]!==c?(me=(s,r)=>{const n=c[s];if(!n)return;const l=n.notes[r];l?.image_preview_urls?.length&&l.image_preview_urls.forEach(ct);const o=n.notes.filter((d,m)=>m!==r);ze(s,{notes:o})},e[31]=c,e[32]=me):me=e[32];const H=me;let ue;e[33]!==c?(ue=(s,r,n)=>{if(!n.length)return;const l=c[s];if(!l)return;const o=l.notes[r]??He(),d=n.map(at);Ge(s,r,{image_files:[...o.image_files,...n],image_preview_urls:[...o.image_preview_urls,...d]})},e[33]=c,e[34]=ue):ue=e[34];const y=ue;let fe;e[35]!==c?(fe=(s,r,n)=>{const l=c[s];if(!l)return;const o=l.notes[r];if(!o)return;const d=o.image_preview_urls[n];d&&URL.revokeObjectURL(d),Ge(s,r,{image_files:o.image_files.filter((m,u)=>u!==n),image_preview_urls:o.image_preview_urls.filter((m,u)=>u!==n)})},e[35]=c,e[36]=fe):fe=e[36];const V=fe;let pe;e[37]!==y?(pe=(s,r,n)=>{const l=rt(n);l&&(n.preventDefault(),y(s,r,[l]))},e[37]=y,e[38]=pe):pe=e[38];const K=pe;let ge;e[39]!==w||e[40]!==c||e[41]!==S?(ge=s=>{s.preventDefault(),Me(!0),Ve({});const r=new FormData;r.append("store_id",S),r.append("date",w),Object.values(c).filter(nt).forEach((l,o)=>{r.append(`entities[${o}][entity_id]`,String(l.entity_id)),l.rating_id!==null&&r.append(`entities[${o}][rating_id]`,String(l.rating_id)),l.notes.forEach((d,m)=>{d.note&&r.append(`entities[${o}][notes][${m}][note]`,d.note),d.image_files.forEach((u,f)=>{r.append(`entities[${o}][notes][${m}][images][${f}]`,u)})})}),et.post("/camera-forms",r,{forceFormData:!0,preserveScroll:!0,onSuccess:()=>Me(!1),onError:l=>{Ve(l),Me(!1)}})},e[39]=w,e[40]=c,e[41]=S,e[42]=ge):ge=e[42];const Xe=ge,Ze=a.user;let he;e[43]===Symbol.for("react.memo_cache_sentinel")?(he=t.jsx(tt,{title:"Create Camera Form"}),e[43]=he):he=e[43];let xe;e[44]===Symbol.for("react.memo_cache_sentinel")?(xe=t.jsxs("div",{className:"flex items-center justify-between",children:[t.jsxs("div",{children:[t.jsx("h1",{className:"text-3xl font-bold tracking-tight",children:"Create Camera Form"}),t.jsx("p",{className:"text-sm text-muted-foreground mt-1",children:"Create a new inspection with multiple notes per entity and optional attachments per note (Ctrl+V supported)"})]}),t.jsx("a",{href:"/camera-forms",className:"text-sm font-medium text-muted-foreground hover:text-foreground",children:"← Back"})]}),e[44]=xe):xe=e[44];let be;e[45]===Symbol.for("react.memo_cache_sentinel")?(be=t.jsx("h3",{className:"text-lg font-semibold mb-4",children:"Filter Entities"}),e[45]=be):be=e[45];let ve;e[46]===Symbol.for("react.memo_cache_sentinel")?(ve=t.jsx("label",{className:"text-sm font-medium",children:"Date Range Type"}),e[46]=ve):ve=e[46];let je;e[47]===Symbol.for("react.memo_cache_sentinel")?(je=s=>Ke(s.target.value),e[47]=je):je=e[47];let ye,Ne;e[48]===Symbol.for("react.memo_cache_sentinel")?(ye=t.jsx("option",{value:"daily",children:"Daily"}),Ne=t.jsx("option",{value:"weekly",children:"Weekly"}),e[48]=ye,e[49]=Ne):(ye=e[48],Ne=e[49]);let E;e[50]!==v?(E=t.jsxs("div",{className:"space-y-2",children:[ve,t.jsxs("select",{value:v,onChange:je,className:"flex h-10 w-full rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring",children:[ye,Ne]})]}),e[50]=v,e[51]=E):E=e[51];let _e;e[52]===Symbol.for("react.memo_cache_sentinel")?(_e=t.jsx("label",{className:"text-sm font-medium",children:"Report Type"}),e[52]=_e):_e=e[52];let Se;e[53]===Symbol.for("react.memo_cache_sentinel")?(Se=s=>Je(s.target.value),e[53]=Se):Se=e[53];let we,Ee,ke;e[54]===Symbol.for("react.memo_cache_sentinel")?(we=t.jsx("option",{value:"",children:"All Types"}),Ee=t.jsx("option",{value:"main",children:"Main"}),ke=t.jsx("option",{value:"secondary",children:"Secondary"}),e[54]=we,e[55]=Ee,e[56]=ke):(we=e[54],Ee=e[55],ke=e[56]);let k;e[57]!==x?(k=t.jsxs("div",{className:"space-y-2",children:[_e,t.jsxs("select",{value:x,onChange:Se,className:"flex h-10 w-full rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring",children:[we,Ee,ke]})]}),e[57]=x,e[58]=k):k=e[58];let C;e[59]!==E||e[60]!==k?(C=t.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[E,k]}),e[59]=E,e[60]=k,e[61]=C):C=e[61];let R;e[62]!==h.length?(R=t.jsxs("p",{className:"text-xs text-muted-foreground mt-2",children:["Showing ",h.length," entities"]}),e[62]=h.length,e[63]=R):R=e[63];let A;e[64]!==C||e[65]!==R?(A=t.jsxs("div",{className:"rounded-lg border bg-accent/50 p-6",children:[be,C,R]}),e[64]=C,e[65]=R,e[66]=A):A=e[66];let Ce;e[67]===Symbol.for("react.memo_cache_sentinel")?(Ce=t.jsx("h3",{className:"text-lg font-semibold mb-4",children:"Basic Information"}),e[67]=Ce):Ce=e[67];let Re;e[68]===Symbol.for("react.memo_cache_sentinel")?(Re=t.jsxs("label",{className:"text-sm font-medium",children:["Store ",t.jsx("span",{className:"text-destructive",children:"*"})]}),e[68]=Re):Re=e[68];let Ae;e[69]===Symbol.for("react.memo_cache_sentinel")?(Ae=s=>Qe(s.target.value),e[69]=Ae):Ae=e[69];let De;e[70]===Symbol.for("react.memo_cache_sentinel")?(De=t.jsx("option",{value:"",children:"Select Store"}),e[70]=De):De=e[70];let D;e[71]!==Le?(D=Le.map(it),e[71]=Le,e[72]=D):D=e[72];let T;e[73]!==S||e[74]!==D?(T=t.jsxs("select",{value:S,onChange:Ae,className:"flex h-10 w-full rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring",required:!0,children:[De,D]}),e[73]=S,e[74]=D,e[75]=T):T=e[75];let F;e[76]!==p.store_id?(F=p.store_id&&t.jsx("p",{className:"text-sm text-destructive",children:p.store_id}),e[76]=p.store_id,e[77]=F):F=e[77];let U;e[78]!==T||e[79]!==F?(U=t.jsxs("div",{className:"space-y-2",children:[Re,T,F]}),e[78]=T,e[79]=F,e[80]=U):U=e[80];let Te;e[81]===Symbol.for("react.memo_cache_sentinel")?(Te=t.jsxs("label",{className:"text-sm font-medium",children:["Date ",t.jsx("span",{className:"text-destructive",children:"*"})]}),e[81]=Te):Te=e[81];let Fe;e[82]===Symbol.for("react.memo_cache_sentinel")?(Fe=s=>Ye(s.target.value),e[82]=Fe):Fe=e[82];let $;e[83]!==w?($=t.jsx("input",{type:"date",value:w,onChange:Fe,className:"flex h-10 w-full rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring",required:!0}),e[83]=w,e[84]=$):$=e[84];let O;e[85]!==p.date?(O=p.date&&t.jsx("p",{className:"text-sm text-destructive",children:p.date}),e[85]=p.date,e[86]=O):O=e[86];let L;e[87]!==$||e[88]!==O?(L=t.jsxs("div",{className:"space-y-2",children:[Te,$,O]}),e[87]=$,e[88]=O,e[89]=L):L=e[89];let B;e[90]!==U||e[91]!==L?(B=t.jsxs("div",{className:"rounded-lg border bg-card p-6",children:[Ce,t.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[U,L]})]}),e[90]=U,e[91]=L,e[92]=B):B=e[92];let M;if(e[93]!==y||e[94]!==q||e[95]!==c||e[96]!==j||e[97]!==K||e[98]!==W||e[99]!==V||e[100]!==H||e[101]!==Pe){let s;e[103]!==y||e[104]!==q||e[105]!==c||e[106]!==j||e[107]!==K||e[108]!==W||e[109]!==V||e[110]!==H?(s=r=>{const n=j[r];return t.jsxs("div",{className:"rounded-lg border bg-card",children:[t.jsx("div",{className:"border-b bg-muted/50 px-6 py-4",children:t.jsx("h3",{className:"text-lg font-semibold",children:r})}),t.jsx("div",{className:"p-6 space-y-4",children:n.map(l=>{const o=c[l.id],d=o?.notes??[];return t.jsxs("div",{className:"p-4 rounded-md bg-muted/20 space-y-4",children:[t.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-4 gap-4",children:[t.jsx("div",{className:"flex items-center",children:t.jsx("label",{className:"text-sm font-medium",children:l.entity_label})}),t.jsx("div",{className:"space-y-1",children:t.jsxs("select",{value:o?.rating_id??"",onChange:m=>ze(l.id,{rating_id:m.target.value?Number(m.target.value):null}),className:"flex h-9 w-full rounded-md border border-input bg-background px-3 py-1 text-sm focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring",children:[t.jsx("option",{value:"",children:"Select Rating"}),W.map(lt)]})}),t.jsx("div",{className:"lg:col-span-2 flex justify-end",children:t.jsx("button",{type:"button",onClick:()=>q(l.id),className:"text-xs rounded-md border px-3 py-2 hover:bg-accent",children:"+ Add Note / Attachment"})})]}),d.length?t.jsx("div",{className:"space-y-3",children:d.map((m,u)=>t.jsxs("div",{className:"rounded-md border bg-background p-4 space-y-3",children:[t.jsxs("div",{className:"flex items-center justify-between gap-2",children:[t.jsxs("div",{className:"text-xs font-semibold text-muted-foreground",children:["Note #",u+1]}),t.jsx("button",{type:"button",onClick:()=>H(l.id,u),className:"text-xs rounded-md border px-2 py-1 hover:bg-accent",children:"Remove Note"})]}),t.jsx("textarea",{value:m.note,onChange:f=>Ge(l.id,u,{note:f.target.value}),placeholder:"Write a note (optional)",className:"min-h-[80px] w-full rounded-md border border-input bg-background px-3 py-2 text-sm focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring"}),t.jsxs("div",{onPaste:f=>K(l.id,u,f),className:"rounded-md border border-dashed bg-background p-3",tabIndex:0,children:[t.jsxs("div",{className:"text-xs text-muted-foreground",children:["Click here then"," ",t.jsx("span",{className:"font-semibold",children:"Ctrl+V"})," ","to paste images, or choose files:"]}),t.jsx("div",{className:"mt-2 flex items-center gap-2",children:t.jsx("input",{type:"file",accept:"image/*",multiple:!0,onChange:f=>{const qe=Array.from(f.target.files??[]);y(l.id,u,qe),f.currentTarget.value=""},className:"block w-full text-xs"})}),m.image_preview_urls.length?t.jsx("div",{className:"mt-3 space-y-2",children:m.image_preview_urls.map((f,qe)=>t.jsxs("div",{className:"flex items-center gap-2",children:[t.jsx("img",{src:f,alt:"Preview",className:"max-h-24 rounded-md border"}),t.jsx("button",{type:"button",onClick:()=>V(l.id,u,qe),className:"text-xs rounded-md border px-2 py-1 hover:bg-accent",children:"Remove"})]},f))}):null]})]},u))}):t.jsx("div",{className:"text-xs text-muted-foreground",children:"No notes yet. Use “Add Note / Attachment”."})]},l.id)})})]},r)},e[103]=y,e[104]=q,e[105]=c,e[106]=j,e[107]=K,e[108]=W,e[109]=V,e[110]=H,e[111]=s):s=e[111],M=Pe.map(s),e[93]=y,e[94]=q,e[95]=c,e[96]=j,e[97]=K,e[98]=W,e[99]=V,e[100]=H,e[101]=Pe,e[102]=M}else M=e[102];let P;e[112]!==M?(P=t.jsx("div",{className:"space-y-4",children:M}),e[112]=M,e[113]=P):P=e[113];let z;e[114]!==p.entities?(z=p.entities&&t.jsx("p",{className:"text-sm text-destructive",children:p.entities}),e[114]=p.entities,e[115]=z):z=e[115];let Ue;e[116]===Symbol.for("react.memo_cache_sentinel")?(Ue=t.jsx("a",{href:"/camera-forms",className:"inline-flex items-center justify-center rounded-md border border-input bg-background px-4 py-2 text-sm font-medium hover:bg-accent hover:text-accent-foreground",children:"Cancel"}),e[116]=Ue):Ue=e[116];const We=ee?"Saving...":"Create Form";let G;e[117]!==ee||e[118]!==We?(G=t.jsxs("div",{className:"flex justify-end gap-3 pt-6 border-t",children:[Ue,t.jsx("button",{type:"submit",disabled:ee,className:"inline-flex items-center justify-center rounded-md bg-primary px-4 py-2 text-sm font-medium text-primary-foreground shadow hover:bg-primary/90 disabled:opacity-50",children:We})]}),e[117]=ee,e[118]=We,e[119]=G):G=e[119];let X;e[120]!==Xe||e[121]!==A||e[122]!==B||e[123]!==P||e[124]!==z||e[125]!==G?(X=t.jsxs("div",{className:"flex flex-1 flex-col gap-4 p-4 pt-0",children:[xe,t.jsxs("form",{onSubmit:Xe,className:"space-y-6",children:[A,B,P,z,G]})]}),e[120]=Xe,e[121]=A,e[122]=B,e[123]=P,e[124]=z,e[125]=G,e[126]=X):X=e[126];let $e;return e[127]!==a.user||e[128]!==X?($e=t.jsxs(st,{user:Ze,children:[he,X]}),e[127]=a.user,e[128]=X,e[129]=$e):$e=e[129],$e}function lt(i){return t.jsx("option",{value:i.id,children:i.label},i.id)}function it(i){return t.jsx("option",{value:i.id,children:i.store},i.id)}function nt(i){const e=i.rating_id!==null,a=i.notes?.some(ot)??!1;return e||a}function ot(i){const e=i.note&&i.note.trim()!=="",a=i.image_files.length>0;return e||a}function at(i){return URL.createObjectURL(i)}function ct(i){return URL.revokeObjectURL(i)}function dt(i,e){const a=e.category?.label||"Uncategorized";return i[a]||(i[a]=[]),i[a].push(e),i}function mt(i,e){const a=i.sort_order??Number.MAX_SAFE_INTEGER,g=e.sort_order??Number.MAX_SAFE_INTEGER;return a!==g?a-g:i.entity_label.localeCompare(e.entity_label)}function ut(){const i=new Date;return new Date(i.getTime()-i.getTimezoneOffset()*6e4).toISOString().slice(0,10)}export{jt as default};
