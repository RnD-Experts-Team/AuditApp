import{c as Xe,r as v,j as t,a as Ie,H as qe}from"./app-0-cEbQZf.js";import{A as He}from"./app-layout-B-Zvyamh.js";import"./app-oXLXr3Y0.js";import"./button-ozQ66l2n.js";import"./index-CNGqGlaO.js";import"./index-C2h5YoHJ.js";import"./index-AaGKiXUI.js";function We(i){const e=i.clipboardData?.items;if(!e)return null;for(const a of e)if(a.type.startsWith("image/")){const o=a.getAsFile();if(!o)return null;const y=a.type==="image/png"?"png":a.type==="image/webp"?"webp":"jpg";return new File([o],`pasted-${Date.now()}.${y}`,{type:a.type})}return null}function at(i){const e=Xe.c(117),{auth:a,entities:o,ratings:y,stores:I}=i;let q;e[0]!==o?(q=o===void 0?[]:o,e[0]=o,e[1]=q):q=e[1];const ke=q;let H;e[2]!==y?(H=y===void 0?[]:y,e[2]=y,e[3]=H):H=e[3];const L=H;let W;e[4]!==I?(W=I===void 0?[]:I,e[4]=I,e[5]=W):W=e[5];const Ce=W,[x,Me]=v.useState("daily"),[p,Pe]=v.useState(""),[j,ze]=v.useState(""),[N,Ge]=v.useState(Ze);let K;e[6]===Symbol.for("react.memo_cache_sentinel")?(K={},e[6]=K):K=e[6];const[m,Ue]=v.useState(K),[V,Re]=v.useState(!1);let J;e[7]===Symbol.for("react.memo_cache_sentinel")?(J={},e[7]=J):J=e[7];const[c,$e]=v.useState(J);let Q;if(e[8]!==x||e[9]!==ke||e[10]!==p){let s;e[12]!==x||e[13]!==p?(s=l=>{const n=l.date_range_type===x,r=!p||l.report_type===p;return n&&r},e[12]=x,e[13]=p,e[14]=s):s=e[14],Q=ke.filter(s),e[8]=x,e[9]=ke,e[10]=p,e[11]=Q}else Q=e[11];const u=Q;let Y,Z;e[15]!==u?(Y=()=>{Ue(s=>{const l={...s};return u.forEach(n=>{l[n.id]||(l[n.id]={entity_id:n.id,rating_id:null,note:"",image_file:null,image_preview_url:null,remove_image:!1})}),l})},Z=[u],e[15]=u,e[16]=Y,e[17]=Z):(Y=e[16],Z=e[17]),v.useEffect(Y,Z);let ee;e[18]!==u?(ee=[...u].sort(Ye),e[18]=u,e[19]=ee):ee=e[19];const g=ee;let te;e[20]!==g?(te=g.reduce(Qe,{}),e[20]=g,e[21]=te):te=e[21];const h=te;let se;if(e[22]!==h||e[23]!==g){const s=Object.keys(h);let l;e[25]!==g?(l=(n,r)=>{const d=g.find(Te=>(Te.category?.label||"Uncategorized")===n)?.category,f=g.find(Te=>(Te.category?.label||"Uncategorized")===r)?.category,Oe=d?.sort_order??Number.MAX_SAFE_INTEGER,Be=f?.sort_order??Number.MAX_SAFE_INTEGER;return Oe!==Be?Oe-Be:n.localeCompare(r)},e[25]=g,e[26]=l):l=e[26],se=s.sort(l),e[22]=h,e[23]=g,e[24]=se}else se=e[24];const De=se;let le;e[27]===Symbol.for("react.memo_cache_sentinel")?(le=(s,l,n)=>{Ue(r=>({...r,[s]:{...r[s]??{entity_id:s,rating_id:null,note:"",image_file:null,image_preview_url:null,remove_image:!1},[l]:n}}))},e[27]=le):le=e[27];const _=le;let ie;e[28]!==m?(ie=(s,l)=>{const n=m[s];if(n?.image_preview_url&&URL.revokeObjectURL(n.image_preview_url),!l){_(s,"image_file",null),_(s,"image_preview_url",null);return}_(s,"image_file",l),_(s,"image_preview_url",URL.createObjectURL(l)),_(s,"remove_image",!1)},e[28]=m,e[29]=ie):ie=e[29];const b=ie;let re;e[30]!==b?(re=(s,l)=>{const n=We(l);n&&(l.preventDefault(),b(s,n))},e[30]=b,e[31]=re):re=e[31];const X=re;let ne;e[32]!==N||e[33]!==m||e[34]!==j?(ne=s=>{s.preventDefault(),Re(!0),$e({});const l=new FormData;l.append("store_id",j),l.append("date",N),Object.values(m).filter(Je).forEach((r,d)=>{l.append(`entities[${d}][entity_id]`,String(r.entity_id)),r.rating_id!==null&&l.append(`entities[${d}][rating_id]`,String(r.rating_id)),r.note&&l.append(`entities[${d}][note]`,r.note),r.image_file&&l.append(`entities[${d}][image]`,r.image_file)}),Ie.post("/camera-forms",l,{forceFormData:!0,preserveScroll:!0,onSuccess:()=>Re(!1),onError:r=>{$e(r),Re(!1)}})},e[32]=N,e[33]=m,e[34]=j,e[35]=ne):ne=e[35];const Ae=ne,Le=a.user;let ae;e[36]===Symbol.for("react.memo_cache_sentinel")?(ae=t.jsx(qe,{title:"Create Camera Form"}),e[36]=ae):ae=e[36];let oe;e[37]===Symbol.for("react.memo_cache_sentinel")?(oe=t.jsxs("div",{className:"flex items-center justify-between",children:[t.jsxs("div",{children:[t.jsx("h1",{className:"text-3xl font-bold tracking-tight",children:"Create Camera Form"}),t.jsx("p",{className:"text-sm text-muted-foreground mt-1",children:"Create a new inspection and optionally attach images per entity"})]}),t.jsx("a",{href:"/camera-forms",className:"text-sm font-medium text-muted-foreground hover:text-foreground",children:"â† Back"})]}),e[37]=oe):oe=e[37];let ce;e[38]===Symbol.for("react.memo_cache_sentinel")?(ce=t.jsx("h3",{className:"text-lg font-semibold mb-4",children:"Filter Entities"}),e[38]=ce):ce=e[38];let de;e[39]===Symbol.for("react.memo_cache_sentinel")?(de=t.jsx("label",{className:"text-sm font-medium",children:"Date Range Type"}),e[39]=de):de=e[39];let me;e[40]===Symbol.for("react.memo_cache_sentinel")?(me=s=>Me(s.target.value),e[40]=me):me=e[40];let ue,fe;e[41]===Symbol.for("react.memo_cache_sentinel")?(ue=t.jsx("option",{value:"daily",children:"Daily"}),fe=t.jsx("option",{value:"weekly",children:"Weekly"}),e[41]=ue,e[42]=fe):(ue=e[41],fe=e[42]);let S;e[43]!==x?(S=t.jsxs("div",{className:"space-y-2",children:[de,t.jsxs("select",{value:x,onChange:me,className:"flex h-10 w-full rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring",children:[ue,fe]})]}),e[43]=x,e[44]=S):S=e[44];let pe;e[45]===Symbol.for("react.memo_cache_sentinel")?(pe=t.jsx("label",{className:"text-sm font-medium",children:"Report Type"}),e[45]=pe):pe=e[45];let ge;e[46]===Symbol.for("react.memo_cache_sentinel")?(ge=s=>Pe(s.target.value),e[46]=ge):ge=e[46];let be,xe,he;e[47]===Symbol.for("react.memo_cache_sentinel")?(be=t.jsx("option",{value:"",children:"All Types"}),xe=t.jsx("option",{value:"main",children:"Main"}),he=t.jsx("option",{value:"secondary",children:"Secondary"}),e[47]=be,e[48]=xe,e[49]=he):(be=e[47],xe=e[48],he=e[49]);let w;e[50]!==p?(w=t.jsxs("div",{className:"space-y-2",children:[pe,t.jsxs("select",{value:p,onChange:ge,className:"flex h-10 w-full rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring",children:[be,xe,he]})]}),e[50]=p,e[51]=w):w=e[51];let E;e[52]!==S||e[53]!==w?(E=t.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[S,w]}),e[52]=S,e[53]=w,e[54]=E):E=e[54];let k;e[55]!==u.length?(k=t.jsxs("p",{className:"text-xs text-muted-foreground mt-2",children:["Showing ",u.length," entities"]}),e[55]=u.length,e[56]=k):k=e[56];let C;e[57]!==E||e[58]!==k?(C=t.jsxs("div",{className:"rounded-lg border bg-accent/50 p-6",children:[ce,E,k]}),e[57]=E,e[58]=k,e[59]=C):C=e[59];let ve;e[60]===Symbol.for("react.memo_cache_sentinel")?(ve=t.jsx("h3",{className:"text-lg font-semibold mb-4",children:"Basic Information"}),e[60]=ve):ve=e[60];let _e;e[61]===Symbol.for("react.memo_cache_sentinel")?(_e=t.jsxs("label",{className:"text-sm font-medium",children:["Store ",t.jsx("span",{className:"text-destructive",children:"*"})]}),e[61]=_e):_e=e[61];let ye;e[62]===Symbol.for("react.memo_cache_sentinel")?(ye=s=>ze(s.target.value),e[62]=ye):ye=e[62];let je;e[63]===Symbol.for("react.memo_cache_sentinel")?(je=t.jsx("option",{value:"",children:"Select Store"}),e[63]=je):je=e[63];let R;e[64]!==Ce?(R=Ce.map(Ve),e[64]=Ce,e[65]=R):R=e[65];let D;e[66]!==j||e[67]!==R?(D=t.jsxs("select",{value:j,onChange:ye,className:"flex h-10 w-full rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring",required:!0,children:[je,R]}),e[66]=j,e[67]=R,e[68]=D):D=e[68];let A;e[69]!==c.store_id?(A=c.store_id&&t.jsx("p",{className:"text-sm text-destructive",children:c.store_id}),e[69]=c.store_id,e[70]=A):A=e[70];let F;e[71]!==D||e[72]!==A?(F=t.jsxs("div",{className:"space-y-2",children:[_e,D,A]}),e[71]=D,e[72]=A,e[73]=F):F=e[73];let Ne;e[74]===Symbol.for("react.memo_cache_sentinel")?(Ne=t.jsxs("label",{className:"text-sm font-medium",children:["Date ",t.jsx("span",{className:"text-destructive",children:"*"})]}),e[74]=Ne):Ne=e[74];let Se;e[75]===Symbol.for("react.memo_cache_sentinel")?(Se=s=>Ge(s.target.value),e[75]=Se):Se=e[75];let T;e[76]!==N?(T=t.jsx("input",{type:"date",value:N,onChange:Se,className:"flex h-10 w-full rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring",required:!0}),e[76]=N,e[77]=T):T=e[77];let U;e[78]!==c.date?(U=c.date&&t.jsx("p",{className:"text-sm text-destructive",children:c.date}),e[78]=c.date,e[79]=U):U=e[79];let $;e[80]!==T||e[81]!==U?($=t.jsxs("div",{className:"space-y-2",children:[Ne,T,U]}),e[80]=T,e[81]=U,e[82]=$):$=e[82];let O;e[83]!==F||e[84]!==$?(O=t.jsxs("div",{className:"rounded-lg border bg-card p-6",children:[ve,t.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[F,$]})]}),e[83]=F,e[84]=$,e[85]=O):O=e[85];let B;if(e[86]!==m||e[87]!==h||e[88]!==X||e[89]!==b||e[90]!==L||e[91]!==De){let s;e[93]!==m||e[94]!==h||e[95]!==X||e[96]!==b||e[97]!==L?(s=l=>{const n=h[l];return t.jsxs("div",{className:"rounded-lg border bg-card",children:[t.jsx("div",{className:"border-b bg-muted/50 px-6 py-4",children:t.jsx("h3",{className:"text-lg font-semibold",children:l})}),t.jsx("div",{className:"p-6 space-y-4",children:n.map(r=>{const d=m[r.id];return t.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-4 gap-4 p-4 rounded-md bg-muted/20",children:[t.jsx("div",{className:"flex items-center",children:t.jsx("label",{className:"text-sm font-medium",children:r.entity_label})}),t.jsx("div",{className:"space-y-1",children:t.jsxs("select",{value:d?.rating_id??"",onChange:f=>_(r.id,"rating_id",f.target.value?Number(f.target.value):null),className:"flex h-9 w-full rounded-md border border-input bg-background px-3 py-1 text-sm focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring",children:[t.jsx("option",{value:"",children:"Select Rating"}),L.map(Ke)]})}),t.jsx("div",{className:"space-y-1",children:t.jsx("input",{type:"text",placeholder:"Note (optional)",value:d?.note??"",onChange:f=>_(r.id,"note",f.target.value),className:"flex h-9 w-full rounded-md border border-input bg-background px-3 py-1 text-sm focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring"})}),t.jsx("div",{className:"space-y-2",children:t.jsxs("div",{onPaste:f=>X(r.id,f),className:"rounded-md border border-dashed bg-background p-3",tabIndex:0,children:[t.jsxs("div",{className:"text-xs text-muted-foreground",children:["Click here then"," ",t.jsx("span",{className:"font-semibold",children:"Ctrl+V"})," to paste an image, or choose a file:"]}),t.jsxs("div",{className:"mt-2 flex items-center gap-2",children:[t.jsx("input",{type:"file",accept:"image/*",onChange:f=>b(r.id,f.target.files?.[0]??null),className:"block w-full text-xs"}),d?.image_file&&t.jsx("button",{type:"button",onClick:()=>b(r.id,null),className:"text-xs rounded-md border px-2 py-1 hover:bg-accent",children:"Remove"})]}),d?.image_preview_url&&t.jsx("div",{className:"mt-3",children:t.jsx("img",{src:d.image_preview_url,alt:"Preview",className:"max-h-32 rounded-md border"})})]})})]},r.id)})})]},l)},e[93]=m,e[94]=h,e[95]=X,e[96]=b,e[97]=L,e[98]=s):s=e[98],B=De.map(s),e[86]=m,e[87]=h,e[88]=X,e[89]=b,e[90]=L,e[91]=De,e[92]=B}else B=e[92];let M;e[99]!==B?(M=t.jsx("div",{className:"space-y-4",children:B}),e[99]=B,e[100]=M):M=e[100];let P;e[101]!==c.entities?(P=c.entities&&t.jsx("p",{className:"text-sm text-destructive",children:c.entities}),e[101]=c.entities,e[102]=P):P=e[102];let we;e[103]===Symbol.for("react.memo_cache_sentinel")?(we=t.jsx("a",{href:"/camera-forms",className:"inline-flex items-center justify-center rounded-md border border-input bg-background px-4 py-2 text-sm font-medium hover:bg-accent hover:text-accent-foreground",children:"Cancel"}),e[103]=we):we=e[103];const Fe=V?"Saving...":"Create Form";let z;e[104]!==V||e[105]!==Fe?(z=t.jsxs("div",{className:"flex justify-end gap-3 pt-6 border-t",children:[we,t.jsx("button",{type:"submit",disabled:V,className:"inline-flex items-center justify-center rounded-md bg-primary px-4 py-2 text-sm font-medium text-primary-foreground shadow hover:bg-primary/90 disabled:opacity-50",children:Fe})]}),e[104]=V,e[105]=Fe,e[106]=z):z=e[106];let G;e[107]!==Ae||e[108]!==C||e[109]!==O||e[110]!==M||e[111]!==P||e[112]!==z?(G=t.jsxs("div",{className:"flex flex-1 flex-col gap-4 p-4 pt-0",children:[oe,t.jsxs("form",{onSubmit:Ae,className:"space-y-6",children:[C,O,M,P,z]})]}),e[107]=Ae,e[108]=C,e[109]=O,e[110]=M,e[111]=P,e[112]=z,e[113]=G):G=e[113];let Ee;return e[114]!==a.user||e[115]!==G?(Ee=t.jsxs(He,{user:Le,children:[ae,G]}),e[114]=a.user,e[115]=G,e[116]=Ee):Ee=e[116],Ee}function Ke(i){return t.jsx("option",{value:i.id,children:i.label},i.id)}function Ve(i){return t.jsx("option",{value:i.id,children:i.store},i.id)}function Je(i){const e=i.rating_id!==null,a=i.note&&i.note.trim()!=="",o=!!i.image_file;return e||a||o}function Qe(i,e){const a=e.category?.label||"Uncategorized";return i[a]||(i[a]=[]),i[a].push(e),i}function Ye(i,e){const a=i.sort_order??Number.MAX_SAFE_INTEGER,o=e.sort_order??Number.MAX_SAFE_INTEGER;return a!==o?a-o:i.entity_label.localeCompare(e.entity_label)}function Ze(){const i=new Date;return new Date(i.getTime()-i.getTimezoneOffset()*6e4).toISOString().slice(0,10)}export{at as default};
